<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro</title>
  <link rel="stylesheet" href="../css/index.css">
  <!-- Estilos Bootstrap 5.2 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  
</head>
<body>
  <nav >
    <a href="../login.php"><img src="../img/logo.PNG" alt="logo"></a>
    <h2 id="nav">Bienvenido Realice su venta aqui</h2>
    <a class="btn btn-outline-dark" href="#">Reportes</a>
    <a class="btn btn-outline-dark" href="./ventas.view.php">Listas de venta</a>
    <a class="btn btn-outline-dark" href="#">Mesas Disponibles</a>
    <a class="btn btn-outline-dark" href="#">Cerrar Sesion</a>
  </nav>

  <div class="container">
    <div class="row">
      <div class="col-md-12">
          <div class="mb-5 mt-5">
            <form action="" autocomplete="off" id="formulario-Venta">
              <div class="card">
                <div class="card-header text-black">
                    Registro de Detalle de Venta
                </div>
                <div class="card-body">
      
                <div class="row">
                  <div class="col-md-3 mt-4" >
                    <label for="precio" class="form-label ">Precio</label>
                    <input type="number" class="form-control">
                  </div>
                  <div class="col-md-3 mt-4" >
                    <label for="cantidad" class="form-label ">Cantidad</label>
                    <input type="number" class="form-control">
                  </div>
                  <div class="col-md-3 mt-4">
                    <label for="precioT" class="form-label "> Total</label>
                    <input type="text" class="form-control">
                  </div>
                  <div class="col-md-3 mt-4">
                    <label for="tipo" class="form-label ">Tipo De Pago</label>
                    <select name="tipo" id="tipo"  class="form-select">
      
                    </select>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 mt-4" >
                    <label for="plato" class="form-label">Cliente</label>  
                        <select name="" id="cliente" class="form-select">

                        </select>
                  </div>
                  <div class="col-md-6 mt-4" >
                    <label for="precio" class="form-label ">Comprobante</label>
                    <select name="" id="comprobante" class="form-select">

                    </select>
                  </div>
                </div>

                <div class="row">
                    <div class="md-3 mt-4">
                      <button class="btn btn-outline-info" id="registrar">Registrar</button>
                      <button class="btn btn-outline-success">Calcular</button>
                    </div>
                  </div>
                  <div class="col-md-6">
                  </div>
                </div>
                </div>
              </div>
            </form> 
            <button type="button" id="abrir-modal-venta" class="btn btn-outline-secondary mt-5" data-bs-toggle="modal" data-bs-target="#modal-registro-venta">Detalle Venta</button>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row mt-5 ">
      <div class="col-md-6 mb-5">
        <canvas id="grafico1"></canvas>
      </div>
      <div class="col-md-6 mb-5">
        <canvas id="grafico2"></canvas>
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    
  <!-- Primer modal: registro de ventas-->
  <div class="modal fade" id="modal-registro-venta" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
        <div class="modal-content">
            <div id="modal-registro-header" class="modal-header bg-info text-light">
                <h5 class="modal-title" id="modal-registro-titulo">Registro Venta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form action="" autocomplete="off" id="formulario-Venta">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-4 mt-4" >
                      <label for="turno" class="form-label ">Turno</label>
                      <select name="" id="turno" class="form-select">

                      </select>
                    </div>
                    <div class="col-md-4 mt-4">
                      <label for="admi" class="form-label ">Administrador</label>
                      <select name="" id="admi" class="form-select">

                      </select>
                    </div>
                    <div class="col-md-4 mt-4">
                      <label for="mesa" class="form-label ">Mesa</label>
                      <select name="" id="mesa" class="form-select">

                      </select>
                    </div>
                  </div>
        
                  <div class="row">
                    <div class="col-md-6 mt-4" >
                      <label for="tipoP" class="form-label">Tipo de Plato</label>
                      <select name="" id="tipoP" class="form-select">

                      </select>
                    </div>
                    <div class="col-md-6 mt-4">
                      <label for="plato" class="form-label">Plato</label>  
                      <input type="text" id="plato" class="form-control">
                    </div>
                  </div>

                  <div class="row">
                    <div class="md-3 mt-4">
                      <button class="btn btn-outline-info" id="registrar1">Registrar</button>
                    </div>
                    <div class="col-md-6">
                    </div>
                  </div>
                </div>
                
              </form> 
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () =>{
      const btMostrar = document.querySelector("#abrir-modal-venta");
      const lienzo1 = document.querySelector("#grafico1");
      const lienzo2 = document.querySelector("#grafico2");
      const btregistrar = document.querySelector("#registrar1");

      const selectcompro = document.querySelector("#comprobante");
      const selecturno = document.querySelector("#turno");
      const selectadmi = document.querySelector("#admi");
      const selectmesa = document.querySelector("#mesa");
      const selecttipo = document.querySelector("#tipo");
      const selectPlatp = document.querySelector("#tipoP");
      const plato = document.querySelector("#plato");
      const selectcliente = document.querySelector("#cliente");
      const comprobante = document.querySelector("#comprobante");

      const graficoBarras = new Chart(lienzo1, {
        type: 'bar',
        data: {
          labels: ['Rojo','Amarillo','Azul'],
          datasets: [
            {
              borderColor: '#734C3C',
              backgroundColor: ['#2E86C1','#9DEDDF','#A69DED','#F68FBB'],
              label: 'Turnos',
              data: [5,10,15,19],
              borderWidth: 1
            }
          ]
        }
      });
      const graficoDona = new Chart(lienzo2, {
        type: 'pie',
        data: {
          labels: ['Rojo','Amarillo','Azul'],
          datasets: [
            {
              borderColor: '#734C3C',
              backgroundColor: ['#2E86C1','#9DEDDF','#A69DED',],
              label: 'Puntos',
              data: [5,10,15],
              borderWidth: 1
            }
          ]
        }
      })
      
      function registrarV(){
        if(confirm("esta seguro de guardar")){
          const parametros = new URLSearchParams();
          parametros.append("operacion", "registrarV");

          parametros.append("idturno", document.querySelector("#turno").value);
          parametros.append("idadmi", document.querySelector("#admi").value);
          parametros.append("idmesa", document.querySelector("#mesa").value);
          parametros.append("idTplato", document.querySelector("#tipoP").value);
          parametros.append("plato", document.querySelector("#plato").value);

          fetch("../controller/Ventas.controller.php" ,{
            method: 'POST',
            body: parametros
          })
          .then(response => response.json())
          .then(datos => {
            if(datos.status){
              document.querySelector("#formulario-Venta").reset();
              document.querySelector("#turno").focus();
            }else{
              alert(datos.message);
            }
          })
        }
      }
      

      function listarTurno (){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listarturno");

        fetch("../controller/Ventas.controller.php", {
          method: 'POST',
          body: parametros
        })
        .then(response => response.json())
        .then(datos => {
          selecturno.innerHTML = "<option value=''>Seleccione</option>";
          datos.forEach(element => {
            let opcion = `
              <option value='${element.turno}'>${element.turno}</option> 
            `;
            selecturno.innerHTML += opcion;
          });
        });
      }

      function listarMesa (){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listarMesa");

        fetch("../controller/Ventas.controller.php", {
          method: 'POST',
          body: parametros
        })
        .then(response => response.json())
        .then(datos => {
          console.log(datos);
          selectmesa.innerHTML = "<option value=''>Seleccione</option>";
          datos.forEach(element => {
            let opcion2 = `
              <option value='${element.Mesa}'>${element.Mesa}</option> 
            `;
            selectmesa.innerHTML += opcion2;
          });
        });
      }

      function listarPago(){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listarPago");

        fetch("../controller/Ventas.controller.php", {
          method: 'POST',
          body: parametros
        })
        .then(response => response.json())
        .then(datos => {
          selecttipo.innerHTML = "<option value=''>Seleccione</option>";
          datos.forEach(element => {
            let pago = `
              <option value='${element.Tipopago}'>${element.Tipopago}</option> 
            `;
            selecttipo.innerHTML += pago;
          });
        });
      }

      function listarCliente (){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listarCliente");

        fetch("../controller/Ventas.controller.php", {
          method: 'POST',
          body: parametros
        })
        .then(response => response.json())
        .then(datos => {
          selectcliente.innerHTML = "<option value=''>Seleccione</option>";
          datos.forEach(element => {
            let opcion3 = `
              <option value='${element.nombres}${element.apellidos}'>${element.nombres}${element.apellidos}</option> 
            `;
            selectcliente.innerHTML += opcion3;
          });
        });
      }
      
      function listarAdmi (){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listarAdmi");

        fetch("../controller/Ventas.controller.php", {
          method: 'POST',
          body: parametros
        })
        .then(response => response.json())
        .then(datos => {
          selectadmi.innerHTML = "<option value=''>Seleccione</option>";
          datos.forEach(element => {
            let admi = `
              <option value='${element.idadmi}'>${element.nombreusu}</option> 
            `;
            selectadmi.innerHTML += admi;
          });
        });
      }
      
      function listarPlato (){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listarPlato");

        fetch("../controller/Ventas.controller.php", {
          method: 'POST',
          body: parametros
        })
        .then(response => response.json())
        .then(datos => {
          selectPlatp.innerHTML = "<option value=''>Seleccione</option>";
          datos.forEach(element => {
            let platos = `
              <option value='${element.idTplato}'>${element.tipo}</option> 
            `;
            selectPlatp.innerHTML += platos;
          });
        });
      }

      function listarCompro (){
        const parametros = new URLSearchParams();
        parametros.append("operacion","listarCompro");

        fetch("../controller/Ventas.controller.php", {
          method: 'POST',
          body: parametros
        })
        .then(response => response.json())
        .then(datos => {
          selectcompro.innerHTML = "<option value=''>Seleccione</option>";
          datos.forEach(element => {
            let compro = `
              <option value='${element.idcomprobante}'>${element.comprobante}</option> 
            `;
            selectcompro.innerHTML += compro;
          });
        });
      }

      btregistrar.addEventListener("click", registrarV);
      listarCompro();
      listarPlato();
      listarAdmi();
      listarMesa();
      listarTurno();
      listarCliente();
      listarPago();
      btMostrar.addEventListener("click","#modal-registro-venta");
    });
  </script>
</body>
</html>